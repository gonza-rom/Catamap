<!DOCTYPE html>
<html lang="en">

<head>
    <title>Registrate en Catamap</title>
    <link rel="icon" type="image/x-icon" href="./assets/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/styles/registro-usuario.css">
</head>

<body>
    <div class="registro-container">
        <h2>Registro de Usuario</h2>
        <form id="registroForm" novalidate>

            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" name="nombre" required pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+"
                oninput="validarTexto(this, 'errorNombre')">
            <div class="error" id="errorNombre"></div>

            <label for="apellido">Apellido</label>
            <input type="text" id="apellido" name="apellido" required pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+"
                oninput="validarTexto(this, 'errorApellido')">
            <div class="error" id="errorApellido"></div>

            <label for="dni">DNI</label>
            <input type="text" id="dni" name="dni" required pattern="\d{7,8}" oninput="validarDNI(this, 'errorDNI')">
            <div class="error" id="errorDNI"></div>

            <label for="fechaNacimiento">Fecha de Nacimiento</label>
            <input type="date" id="fechaNacimiento" name="fechaNacimiento" required
                onchange="validarFecha(this, 'errorFecha')">
            <div class="error" id="errorFecha"></div>

            <label for="provincia">Provincia</label>
            <input type="text" id="provincia" name="provincia" required>
            <div class="error" id="errorProvincia"></div>

            <label for="departamento">Departamento</label>
            <input type="text" id="departamento" name="departamento" required>
            <div class="error" id="errorDepartamento"></div>

            <label for="localidad">Localidad</label>
            <input type="text" id="localidad" name="localidad" required>
            <div class="error" id="errorLocalidad"></div>

            <label for="usuario">Usuario</label>
            <input type="text" id="usuario" name="usuario" required minlength="4"
                oninput="validarUsuario(this, 'errorUsuario')">
            <div class="error" id="errorUsuario"></div>

            <label for="email">Email</label>
            <input type="email" id="email" name="email" required oninput="validarEmail(this, 'errorEmail')">
            <div class="error" id="errorEmail"></div>

            <label for="telefono">Teléfono</label>
            <input type="tel" id="telefono" name="telefono" required
                oninput="validarTelefono(this, document.getElementById('tipoTelefono'), 'errorTelefono')">
            <select id="tipoTelefono" name="tipoTelefono" required
                onchange="validarTelefono(document.getElementById('telefono'), this, 'errorTelefono')">
                <option value="">Seleccionar tipo</option>
                <option value="celular">Celular</option>
                <option value="fijo">Fijo</option>
            </select>
            <div class="error" id="errorTelefono"></div>

            <label for="password">Contraseña</label>
            <input type="password" id="password" name="password" required
                oninput="validarPassword(this, 'errorPassword')"
                placeholder="Mínimo 8 caracteres, 1 may, 1 min, 1 número">
            <div class="error" id="errorPassword"></div>

            <label for="foto">Foto de usuario</label>
            <input type="file" id="foto" name="foto" accept="image/*" required
                onchange="validarFoto(this, 'errorFoto')">
            <div class="error" id="errorFoto"></div>

            <button type="submit">Registrarse</button>
            <button type="button" class="btn-volver" onclick="window.location.href='../index.html'">Volver</button>

            <p style="text-align:center; margin-top:15px;">
                ¿Ya tenés cuenta? <a href="login.html">Iniciar sesión</a>
            </p>

        </form>
    </div>

    <script>
        const form = document.getElementById('registroForm');

        function validarTexto(campo, errorId) {
            const regex = /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/;
            document.getElementById(errorId).textContent = regex.test(campo.value) ? '' : 'Solo letras permitidas';
        }

        function validarDNI(campo, errorId) {
            document.getElementById(errorId).textContent = /^\d{7,8}$/.test(campo.value) ? '' : 'DNI inválido';
        }

        function validarFecha(campo, errorId) {
            const valor = campo.value;
            if (!valor) {
                document.getElementById(errorId).textContent = 'Debe ingresar fecha';
                return;
            }

            const fecha = new Date(valor);
            const hoy = new Date();

            if (fecha >= hoy) {
                document.getElementById(errorId).textContent = 'La fecha no puede ser futura';
                return;
            }

            // Calcular edad exacta
            let edad = hoy.getFullYear() - fecha.getFullYear();
            const cumpleAnios = (hoy.getMonth() > fecha.getMonth()) ||
                (hoy.getMonth() === fecha.getMonth() && hoy.getDate() >= fecha.getDate());
            edad = cumpleAnios ? edad : edad - 1;

            if (edad < 18 || edad > 100) {
                document.getElementById(errorId).textContent = 'Debe tener entre 18 y 100 años';
            } else {
                document.getElementById(errorId).textContent = '';
            }
        }


        function validarUsuario(campo, errorId) {
            document.getElementById(errorId).textContent = campo.value.length >= 4 ? '' : 'Mínimo 4 caracteres';
        }

        function validarEmail(campo, errorId) {
            document.getElementById(errorId).textContent = campo.checkValidity() ? '' : 'Email inválido';
        }

        function validarTelefono(campo, tipo, errorId) {
            let msg = '';
            if (!/^\d{7,15}$/.test(campo.value)) msg = 'Teléfono inválido';
            if (!tipo.value) msg += ' / Seleccione tipo';
            document.getElementById(errorId).textContent = msg;
        }

        function validarPassword(campo, errorId) {
            const regexPass = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
            document.getElementById(errorId).textContent = regexPass.test(campo.value) ? '' : 'Contraseña no cumple los requisitos';
        }

        function validarFoto(campo, errorId) {
            if (campo.files.length === 0) {
                document.getElementById(errorId).textContent = 'Debe seleccionar una imagen';
            } else if (!campo.files[0].type.startsWith('image/')) {
                document.getElementById(errorId).textContent = 'Archivo no es una imagen';
            } else {
                document.getElementById(errorId).textContent = '';
            }
        }

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            // Ejecutar todas las validaciones
            validarTexto(document.getElementById('nombre'), 'errorNombre');
            validarTexto(document.getElementById('apellido'), 'errorApellido');
            validarDNI(document.getElementById('dni'), 'errorDNI');
            validarFecha(document.getElementById('fechaNacimiento'), 'errorFecha');
            validarUsuario(document.getElementById('usuario'), 'errorUsuario');
            validarEmail(document.getElementById('email'), 'errorEmail');
            validarTelefono(document.getElementById('telefono'), document.getElementById('tipoTelefono'), 'errorTelefono');
            validarPassword(document.getElementById('password'), 'errorPassword');
            validarFoto(document.getElementById('foto'), 'errorFoto');

            // Revisar si hay errores
            const errores = document.querySelectorAll('.error');
            let hayError = false;
            errores.forEach(el => { if (el.textContent) hayError = true; });

            if (!hayError) {
                alert('¡Registro exitoso!');
                form.reset();
            } else {
                alert('Por favor corrige los errores antes de enviar');
            }
        });
    </script>
</body>

</html>