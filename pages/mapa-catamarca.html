<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Mapa interactivo Catamarca</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="/styles/mapa-catamaca.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <!-- üîπ Navbar -->
  <div id="map"></div>
    <div id="sidebar">
      <div class="sidebar-header">
        <h3>Men√∫</h3>
        <span id="closeSidebar">&times;</span> <!-- Bot√≥n de cerrar -->
      </div>
      <a href="/index.html">Inicio</a>
      <a href="/pages/mapa-catamarca.html">Mapa</a>
      <a href="/pages/contacto.html">Contacto</a>
      <a href="/pages/inicio-sesion.html">Iniciar Sesi√≥n</a>
    </div>
   <footer class="footer">
    <div class="footer-container">
        <div class="footer-logo">
        <img src="/img/CATAMAP.png" alt="Catamap Logo">
        </div>
        <div class="footer-links">
        <a href="/index.html">Inicio</a>
        <a href="/pages/mapa-catamarca.html">Mapa</a>
        <a href="/pages/contacto.html">Contacto</a>
        </div>
        <div class="footer-social">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-x-twitter"></i></a>
        </div>
        <p class="footer-copy">¬© 2025 CATAMAP - Todos los derechos reservados</p>
    </div>
    </footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script>
  // Inicializar mapa
  const map = L.map('map');

  // üîπ Capas base
  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
  });

  const voyager = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',
    subdomains: 'abcd'
  });

  const terrain = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom'
  });

  const blanco = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/terrain/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> ¬© <a href="https://carto.com/">CARTO</a>',
    subdomains: 'abcd'
  });

  // Agregar OSM por defecto
  osm.addTo(map);

  // Control de capas
  const baseMaps = {
    "üó∫Ô∏è Rutas": osm,
    "üåç Moderno": voyager,
    "üèîÔ∏è Terreno": terrain,
    "‚ö™ Blanco": blanco
  };

  L.control.layers(baseMaps).addTo(map);

  // üîπ Lugares tur√≠sticos de ejemplo
  const lugaresTuristicos = {
    "CAPAYAN": ["Dique Las Pirquitas", "Huillapima"],
    "BEL√âN": ["Ruinas de Shincal de Quimivil", "Tejidos Artesanales"],
    "ANTOFAGASTA DE LA SIERRA": ["Campo de Piedra P√≥mez", "Laguna Colorada"],
    "TINOGASTA": ["Ruta del Adobe", "Termas de Fiambal√°"]
  };

  // Cargar GeoJSON de Catamarca
  fetch("/data/departamentos-catamarca.json")
    .then(res => res.json())
    .then(geojson => {
      // Crear capa de Catamarca con hover y click
      const geojsonLayer = L.geoJSON(geojson, {
        style: {
          color: "#000",
          weight: 1,
          fillColor: "#66bb6a",
          fillOpacity: 0.6
        },
        onEachFeature: function(feature, layer) {
          // Hover
          layer.on("mouseover", function () {
            layer.setStyle({ fillColor: "#E07B39", fillOpacity: 0. });
            layer.bringToFront();
          });
          layer.on("mouseout", function () {
            geojsonLayer.resetStyle(layer);
          });

          // Click popup
          layer.on("click", function() {
            const depto = feature.properties.departamento.toUpperCase();
            const lugares = lugaresTuristicos[depto] || ["No hay datos cargados"];
            layer.bindPopup(`<b>${depto}</b><br><ul>${lugares.map(l => `<li>${l}</li>`).join("")}</ul>`).openPopup();
          });
        }
      }).addTo(map);

      // üîπ M√°scara para que solo se vea Catamarca
      const world = turf.polygon([[ 
        [-180, -90], [-180, 90], [180, 90], [180, -90], [-180, -90]
      ]]);
      const catamarca = turf.combine(geojson);
      const mask = turf.difference(world, catamarca.features[0]);

      L.geoJSON(mask, {
        style: { color: "#FFFFFF", weight: 1, fillColor: "#ffcba8", fillOpacity: 1 }
      }).addTo(map);

      // Geolocalizaci√≥n del usuario
        map.locate({ setView: false, maxZoom: 14 });
        map.on("locationfound", function (e) {
          L.marker(e.latlng).addTo(map)
            .bindPopup("Est√°s aqu√≠ üìç").openPopup();
        });
      // Ajustar vista y l√≠mites
      map.fitBounds(geojsonLayer.getBounds());
      map.setMaxBounds(geojsonLayer.getBounds());
      map.setMinZoom(map.getZoom());
    });

    // üîπ Crear control hamburguesa
const hamburgerControl = L.control({ position: "topleft" }); // "topleft" lo pone arriba izquierda

hamburgerControl.onAdd = function () {
  const div = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
  div.innerHTML = '<i class="fas fa-bars" style="font-size:20px; padding:8px; cursor:pointer;"></i>';

  // Prevenir que el mapa se mueva al hacer click
  L.DomEvent.disableClickPropagation(div);

  // Acci√≥n al clickear
  div.onclick = function () {
    document.getElementById("sidebar").classList.toggle("show");
  };

  return div;
};

hamburgerControl.addTo(map);

// Bot√≥n cerrar
document.getElementById("closeSidebar").addEventListener("click", () => {
  document.getElementById("sidebar").classList.remove("show");
});
</script>
</body>

</html>